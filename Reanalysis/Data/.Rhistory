#K-S test for SITE groups:
ks.test(live[live$SITE=="IUI_S",]$prop, "pnorm")
View(live)
### Aligned ranks anova:
model_live = art(prop ~ DEPTH,  data = live)
### Check the success of the procedure:
model_live
### Conduct ANOVA:
anova(model_live)
# Posthoc pairwise comparison for DEPTH:
DEPTH_posthoc = art.con(model_live, "DEPTH")
DEPTH_posthoc
Sum_DEPTH = as.data.frame(DEPTH_posthoc)
# Finding the statistical group letter:
cldList(p.value ~ contrast, data=Sum_DEPTH)
View(Sum_DEPTH)
write.csv(Sum_DEPTH,"/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output/live coverage depth posthoc.csv")
# Finding the statistical group letter:
live_depth_stat_letters=as.dataframe (cldList(p.value ~ contrast, data=Sum_DEPTH))
# Finding the statistical group letter:
live_depth_stat_letters=as.data.frame (cldList(p.value ~ contrast, data=Sum_DEPTH))
View(live_depth_stat_letters)
write.csv(live_depth_stat_letters,"/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output/live coverage depth posthoc_letters.csv")
View(Groups_all)
View(Groups_all_image_wide)
# to summarize how many live  and how many Non_live we have per picture:
Groups_all=aggregate(Count~DEPTH+PIC+GROUP, data=data_all, FUN="sum")
# to calculate the proportion:
Groups_all$prop=Groups_all$Count/64
# add variable that gives % coverage instead of proportion
Groups_all$Cov_percent=Groups_all$prop*100
# Converting 'Groups_all' wide, adding 0 values and change it to long again:
Groups_all_image_wide=as.data.frame(Groups_all[,c(3,4,7)] %>%
pivot_wider(names_from = GROUP, values_from = Cov_percent, values_fill=0))
# add variable that gives % coverage instead of proportion
Groups_all$Cov_percent=Groups_all$prop*100
View(Groups_all)
# Converting 'Groups_all' wide, adding 0 values and change it to long again:
Groups_all_image_wide=as.data.frame(Groups_all[,c(3,4,1)] %>%
pivot_wider(names_from = GROUP, values_from = Cov_percent, values_fill=0))
# add variable that gives % coverage instead of proportion
Groups_all$Cov_percent=Groups_all$prop*100
View(Groups_all)
# Converting 'Groups_all' wide, adding 0 values and change it to long again:
Groups_all_image_wide=as.data.frame(Groups_all[,c(3,4,1)] %>%
pivot_wider(names_from = GROUP, values_from = Cov_percent, values_fill=0))
# Converting 'Groups_all' wide, adding 0 values and change it to long again:
Groups_all_image_wide=as.data.frame(Groups_all[,c(3,4,1,6)] %>%
pivot_wider(names_from = GROUP, values_from = Cov_percent, values_fill=0))
# Converting 'Groups_all' wide, adding 0 values and change it to long again:
Groups_all_image_wide=as.data.frame(Groups_all[,c(3,4,6)] %>%
pivot_wider(names_from = GROUP, values_from = Cov_percent, values_fill=0))
# add variable that gives % coverage instead of proportion
Groups_all$Cov_percent=Groups_all$prop*100
# add variable that combines site and depth
Groups_all$site_depth=paste(Groups_all$SITE, Groups_all$DEPTH, sep="_")
str(Groups_all)
# to summarize how many live  and how many Non_live we have per picture:
Groups_all=aggregate(Count~DEPTH+PIC+GROUP, data=data_all, FUN="sum")
# to calculate the proportion:
Groups_all$prop=Groups_all$Count/64
# add variable that gives % coverage instead of proportion
Groups_all$Cov_percent=Groups_all$prop*100
# add variable that combines site and depth
Groups_all$site_depth=paste(Groups_all$SITE, Groups_all$DEPTH, sep="_")
str(Groups_all)
# Converting 'Groups_all' wide, adding 0 values and change it to long again:
Groups_all_image_wide=as.data.frame(Groups_all[,c(3,4,7)] %>%
pivot_wider(names_from = GROUP, values_from = Cov_percent, values_fill=0))
# Converting 'Groups_all' wide, adding 0 values and change it to long again:
Groups_all_image_wide=as.data.frame(Groups_all[,c(3,4,6)] %>%
pivot_wider(names_from = GROUP, values_from = Cov_percent, values_fill=0))
# to summarize how many live  and how many Non_live we have per picture:
Groups_all=aggregate(Count~DEPTH+PIC+GROUP, data=data_all, FUN="sum")
# to calculate the proportion:
Groups_all$prop=Groups_all$Count/64
# add variable that gives % coverage instead of proportion
Groups_all$Cov_percent=Groups_all$prop*100
# add variable that combines site and depth
Groups_all$site_depth=paste(Groups_all$SITE, Groups_all$DEPTH, sep="_")
str(Groups_all)
# Converting 'Groups_all' wide, adding 0 values and change it to long again:
Groups_all_image_wide=as.data.frame(Groups_all[,c(3,4,2)] %>%
pivot_wider(names_from = GROUP, values_from = Cov_percent, values_fill=0))
# Converting 'Groups_all' wide, adding 0 values and change it to long again:
Groups_all_image_wide=as.data.frame(Groups_all[,c(2,3,6)] %>%
pivot_wider(names_from = GROUP, values_from = Cov_percent, values_fill=0))
View(Groups_all_image_wide)
Groups_all_image_wide$SITE=Groups_all$SITE[match(Groups_all_image_wide$PIC,Groups_all$PIC)]
Groups_all_image_wide$DEPTH=Groups_all$DEPTH[match(Groups_all_image_wide$PIC,Groups_all$PIC)]
str(Groups_all_image_wide)
Groups_all_image_wide$SITE=Groups_all$SITE[match(Groups_all_image_wide$PIC,Groups_all$PIC)]
str(Groups_all_image_wide)
Groups_all_image_wide_long=reshape2::melt(Groups_all_image_wide, id.vars=list("PIC", "SITE", "DEPTH"))
Groups_all_image_wide_long=reshape2::melt(Groups_all_image_wide, id.vars=list("PIC", "DEPTH"))
View(Groups_all_image_wide_long)
# Subset the 'Groups_all_image_wide_long' DF for the different live functional groups (7 different DF's):
str(Groups_all_image_wide_long)
HC_df <- subset(Groups_all_image_wide_long, variable == "Hard Coral")
SC_df <- subset(Groups_all_image_wide_long, variable == "Soft Coral")
Sponge_df <- subset(Groups_all_image_wide_long, variable == "Sponge")
Other_Inv_df <- subset(Groups_all_image_wide_long, variable == "Other_Inv")
Algae_df <- subset(Groups_all_image_wide_long, variable == "Algae")
CCA_df <- subset(Groups_all_image_wide_long, variable == "CCA")
Seagrass_df <- subset(Groups_all_image_wide_long, variable == "Seagrass")
####################### HARD CORALS: ART ANOVA test & plot:
### Aligned ranks anova:
model_HC = art(value ~ DEPTH,  data = HC_df)
### Check the success of the procedure:
model_HC
### Conduct ANOVA:
anova(model_HC) # Significant for 3 factors!
# Posthoc pairwise comparison for DEPTH (if interaction significant, then posthoc for interaction is enough)::
DEPTH_HC_posthoc = art.con(model_HC, "DEPTH")
DEPTH_HC_posthoc
Sum_DEPTH_HC = as.data.frame(DEPTH_HC_posthoc)
# Finding the statistical group letter:
cldList(p.value ~ contrast, data=Sum_DEPTH_HC)
# Finding the statistical group letter:
HC_depth_stat_letters=cldList(p.value ~ contrast, data=Sum_DEPTH_HC)
write.csv(Sum_DEPTH_HC,"/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output/HC_depth posthoc.csv")
write.csv(HC_depth_stat_letters,"/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output/HC_depth posthoc_letters.csv")
############### HC plot:
str(HC_df)
p_hard <- ggplot(HC_df, aes(x=DEPTH, y=value,colour=DEPTH))+
geom_boxplot()+
geom_point(position=position_jitter(width=0.2))+
#facet_grid(.~SITE) +
ggtitle("Hard Coral coverage (%)") +
scale_x_discrete(limits = rev)+
xlab("Depth (M)") + ylab("Precentage") +
#scale_y_discrete(limits = rev(levels(HC_df$DEPTH))) + # Depth from shallow to deep
theme_bw() +
coord_flip()+
theme(axis.title.x = element_text(colour="Black", size=14),
axis.title.y = element_text(colour="Black", size=14),
axis.text.x = element_text(size=12),
axis.text.y = element_text(size=12),
legend.title = element_text(size=14),
legend.text = element_text(size=14),
panel.grid.major = element_blank(), # Remove major grid lines
panel.grid.minor = element_blank(), # Remove minor grid lines
strip.text = element_text(size = 18) # Increase font size of facet labels
)
print (p_hard)
# Define output directory
output_path <- "/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output"
# Save plot
ggsave(
filename = file.path(output_path, "Hard coral cover by depth.png"),
width = 8,
height = 6,
dpi = 300
)
ggsave(
filename = file.path(output_path, "Hard coral cover by depth.pdf"),
width = 8,
height = 6
)
####################### SOFT CORALS: ART ANOVA test & plot:
model_SC = art(value ~ DEPTH,  data = SC_df)
model_SC
anova(model_SC) # Significant for 3 factors!
# Posthoc pairwise comparison for the interaction:
DEPTH_SC_posthoc = art.con(model_SC, "DEPTH", adjust="tukey")
DEPTH_SC_posthoc
Sum_DEPTH_SC = as.data.frame(DEPTH_SC_posthoc)
cldList(p.value ~ contrast, data=Sum_DEPTH_SC)
SC_depth_stat_letters=cldList(p.value ~ contrast, data=Sum_DEPTH_SC)
write.csv(Sum_DEPTH_SC,"/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output/SC_depth posthoc.csv")
write.csv(SC_depth_stat_letters,"/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output/SC_depth posthoc_letters.csv")
p_soft <- ggplot(SC_df, aes(x=DEPTH, y=value,colour=DEPTH))+
geom_boxplot()+
geom_point(position=position_jitter(width=0.2))+
#facet_grid(.~SITE) +
ggtitle("Soft Coral coverage (%)") +
scale_x_discrete(limits = rev)+
xlab("Depth (M)") + ylab("Precentage") +
#scale_y_discrete(limits = rev(levels(SC_df$DEPTH))) + # Depth from shallow to deep
theme_bw() +
coord_flip()+
theme(axis.title.x = element_text(colour="Black", size=14),
axis.title.y = element_text(colour="Black", size=14),
axis.text.x = element_text(size=12),
axis.text.y = element_text(size=12),
legend.title = element_text(size=14),
legend.text = element_text(size=14),
panel.grid.major = element_blank(), # Remove major grid lines
panel.grid.minor = element_blank(), # Remove minor grid lines
strip.text = element_text(size = 18) # Increase font size of facet labels
)
print(p_soft)
# Define output directory
output_path <- "/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output"
# Save plot
ggsave(
filename = file.path(output_path, "Soft coral cover by depth.png"),
width = 8,
height = 6,
dpi = 300
)
ggsave(
filename = file.path(output_path, "Soft coral cover by depth.pdf"),
width = 8,
height = 6
)
####################### CCA: ART ANOVA test & plot:
model_CCA = art(value ~ DEPTH, data = CCA_df)
model_CCA
anova(model_CCA) # Significant for 3 factors!
# Posthoc pairwise comparison for the interaction:
DEPTH_CCA_posthoc = art.con(model_CCA, "DEPTH", adjust="tukey")
DEPTH_CCA_posthoc
Sum_DEPTH_CCA = as.data.frame(DEPTH_CCA_posthoc)
cldList(p.value ~ contrast, data=Sum_DEPTH_CCA)
cldList(p.value ~ contrast, data=Sum_DEPTH_CCA)
cldList(p.value ~ contrast, data=Sum_DEPTH_CCA)
write.csv(Sum_DEPTH_CCA,"/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output/CCA_depth posthoc.csv")
write.csv(CCA_depth_stat_letters,"/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output/CCA_depth posthoc_letters.csv")
CCA_depth_stat_letters=cldList(p.value ~ contrast, data=Sum_DEPTH_CCA)
write.csv(CCA_depth_stat_letters,"/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output/CCA_depth posthoc_letters.csv")
p_cca <- ggplot(CCA_df, aes(x=DEPTH, y=value,colour=DEPTH))+
geom_boxplot()+
geom_point(position=position_jitter(width=0.2))+
#facet_grid(.~SITE) +
ggtitle("CCA coverage (%)") +
scale_x_discrete(limits = rev)+
xlab("Depth (M)") + ylab("Precentage") +
#scale_y_discrete(limits = rev(levels(CCA_df$DEPTH))) + # Depth from shallow to deep
theme_bw() +
coord_flip()+
theme(axis.title.x = element_text(colour="Black", size=14),
axis.title.y = element_text(colour="Black", size=14),
axis.text.x = element_text(size=12),
axis.text.y = element_text(size=12),
legend.title = element_text(size=14),
legend.text = element_text(size=14),
panel.grid.major = element_blank(), # Remove major grid lines
panel.grid.minor = element_blank(), # Remove minor grid lines
strip.text = element_text(size = 18) # Increase font size of facet labels
)
print(p_cca)
# Define output directory
output_path <- "/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output"
# Save plot
ggsave(
filename = file.path(output_path, "CCA cover by depth.png"),
width = 8,
height = 6,
dpi = 300
)
ggsave(
filename = file.path(output_path, "CCA cover by depth.pdf"),
width = 8,
height = 6
)
####################### SPONGES: ART ANOVA test & plot:
model_Sponge = art(value ~ DEPTH, data = Sponge_df)
model_Sponge
anova(model_Sponge) # significant for 3 factors!
# Posthoc pairwise comparison for the interaction:
DEPTH_Sponge_posthoc = art.con(model_Sponge, "DEPTH", adjust="tukey")
DEPTH_Sponge_posthoc
Sum_DEPTH_Sponge = as.data.frame(DEPTH_Sponge_posthoc)
cldList(p.value ~ contrast, data=Sum_DEPTH_Sponge)
Sponge_depth_stat_letters=cldList(p.value ~ contrast, data=Sum_DEPTH_Sponge)
write.csv(Sum_DEPTH_Sponge,"/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output/Sponge_depth posthoc.csv")
write.csv(Sponge_depth_stat_letters,"/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output/Sponge_depth posthoc_letters.csv")
p_sponge <-ggplot(Sponge_df, aes(x=DEPTH, y=value,colour=DEPTH))+
geom_boxplot()+
geom_point(position=position_jitter(width=0.2))+
#facet_grid(.~SITE) +
ggtitle("Sponge coverage (%)") +
scale_x_discrete(limits = rev)+
xlab("Depth (M)") + ylab("Precentage") +
#scale_y_discrete(limits = rev(levels(Sponge_df$DEPTH))) + # Depth from shallow to deep
theme_bw() +
coord_flip()+
theme(axis.title.x = element_text(colour="Black", size=14),
axis.title.y = element_text(colour="Black", size=14),
axis.text.x = element_text(size=12),
axis.text.y = element_text(size=12),
legend.title = element_text(size=14),
legend.text = element_text(size=14),
panel.grid.major = element_blank(), # Remove major grid lines
panel.grid.minor = element_blank(), # Remove minor grid lines
strip.text = element_text(size = 18) # Increase font size of facet labels
)
print(p_sponge)
# Define output directory
output_path <- "/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output"
# Save plot
ggsave(
filename = file.path(output_path, "Spong cover by depth.png"),
width = 8,
height = 6,
dpi = 300
)
ggsave(
filename = file.path(output_path, "Spong cover by depth.pdf"),
width = 8,
height = 6
)
p_cca     <- p_cca     + theme(legend.position = "none")
p_hard    <- p_hard    + theme(legend.position = "none")
p_soft    <- p_soft    + theme(legend.position = "none")
p_sponge  <- p_sponge  + theme(legend.position = "none")
# Combine into one panel (2 columns x 3 rows)
combined_panel <- plot_grid(
p_hard,   p_soft,
p_sponge, p_cca,
ncol = 2,
align = "v",
labels = c("A", "B", "C", "D"),      # ⬅️ PANEL LABELS
label_size = 18,                     # ⬅️ size of A–D
label_fontface = "bold",             # ⬅️ bold labels
label_x = 0.02,                      # ⬅️ left position
label_y = 0.98,                      # ⬅️ top position
hjust = 0, vjust = 1
)
# Preview
print(combined_panel)
output_path <- "/Users/talimass/Documents/Documents - MacBook Pro/GitHub/Coral-communities-along-the-depth-gradient-in-the-Red-Sea-reefs-of-Eilat/Reanalysis/Output"
if (!dir.exists(output_path)) dir.create(output_path, recursive = TRUE)
ggsave(
filename = file.path(output_path, "BenthicCover_byDepth_combined.png"),
plot = combined_panel,
width = 10,
height = 12,
dpi = 300,
bg = "white"
)
ggsave(
filename = file.path(output_path, "BenthicCover_byDepth_combined.pdf"),
plot = combined_panel,
width = 10,
height = 12
)
## ---- Data prep ----
Hard_corals_plot$Depth <- as.factor(Hard_corals_plot$Depth)
Hard_corals_plot$Site <- factor(Hard_corals_plot$Site,
levels = c("JG", "IUI-N", "IUI-S"))
Hard_corals_plot_long <- melt(Hard_corals_plot,
id.vars = c("Site", "Depth"),
variable.name = "Category",
value.name = "Percentage")
## ---- Colors ----
num_colors <- length(unique(Hard_corals_plot_long$Category))
color_palette <- colorRampPalette(brewer.pal(12, "Paired"))(num_colors)
## ---- Depth order (shallow to deep) ----
depth_levels <- levels(Hard_corals_plot_long$Depth)
## ---- Base plot (legend formatted for LANDSCAPE export) ----
HC_plot <- ggplot(Hard_corals_plot_long,
aes(x = Percentage, y = Depth, fill = Category)) +
geom_bar(stat = "identity", position = "fill", width = 0.6) +
facet_grid(Site ~ ., scales = "free_y") +
scale_x_continuous(labels = percent_format(accuracy = 1)) +
scale_y_discrete(limits = rev(depth_levels)) +
scale_fill_manual(values = color_palette) +
theme_bw() +
labs(x = "Percentage", y = "Depth (m)", fill = NULL) +
theme(
axis.title.x = element_text(size = 9, colour = "black"),
axis.title.y = element_text(size = 9, colour = "black"),
axis.text.x  = element_text(size = 8),
axis.text.y  = element_text(size = 8),
strip.background = element_blank(),
strip.text = element_text(size = 9),
legend.position  = "bottom",
legend.direction = "horizontal",
legend.title = element_blank(),   # ⬅️ no legend title
legend.text  = element_text(size = 7)
) +
guides(fill = guide_legend(ncol = 6, byrow = TRUE))
## ---- Extract LEGEND robustly (handles multiple guide-box components) ----
leg_list <- get_plot_component(HC_plot, "guide-box", return_all = TRUE)
legend_grob <- NULL
for (i in seq_along(leg_list)) {
g <- leg_list[[i]]
if (!is.null(g) && inherits(g, "grob")) {
# A quick test for "non-empty": has child grobs
if (!is.null(g$grobs) && length(g$grobs) > 0) {
legend_grob <- g
break
}
}
}
if (is.null(legend_grob)) legend_grob <- leg_list[[length(leg_list)]]
# Convert legend grob into a plot that ggsave can write reliably
legend_plot <- cowplot::ggdraw() + cowplot::draw_grob(legend_grob)
## ---- Main plot without legend ----
HC_plot_no_legend <- HC_plot + theme(legend.position = "none")
ggsave(
filename = file.path(output_path, "HardCorals_main_single_column.png"),
plot =HC_plot_no_legend,
width = 10,
height = 12,
dpi = 300,
bg = "white"
)
ggsave(
filename = file.path(output_path, "HardCorals_main_single_column.pdf"),
plot = HC_plot_no_legend,
width = 10,
height = 12
)
ggsave(
filename = file.path(output_path, "HardCorals_legend_landscape.png"),
plot =legend_grob,
width = 10,
height = 12,
dpi = 300,
bg = "white"
)
ggsave(
filename = file.path(output_path, "HardCorals_legend_landscape.pdf"),
plot = legend_grob,
width = 10,
height = 12
)
## ---- Optional: preview ----
print(HC_plot_no_legend)
grid.newpage(); grid.draw(legend_grob)   # preview legend grob
library(ggplot2)
library(reshape2)
library(RColorBrewer)
library(scales)
library(cowplot)
## ---- Data prep ----
Hard_corals_plot$Depth <- as.factor(Hard_corals_plot$Depth)
# Melt to long format
Hard_corals_plot_long <- melt(
Hard_corals_plot,
id.vars = c("Site", "Depth"),
variable.name = "Category",
value.name = "Percentage"
)
## ---- Aggregate across sites (mean per Depth x Category) ----
Hard_corals_depth <- aggregate(
Percentage ~ Depth + Category,
data = Hard_corals_plot_long,
FUN = mean,
na.rm = TRUE
)
## ---- Colors ----
num_colors <- length(unique(Hard_corals_depth$Category))
color_palette <- colorRampPalette(brewer.pal(12, "Paired"))(num_colors)
## ---- Depth order (shallow to deep) ----
depth_levels <- levels(Hard_corals_plot_long$Depth)
Hard_corals_depth$Depth <- factor(Hard_corals_depth$Depth, levels = depth_levels)
## ---- Base plot (BY DEPTH ONLY) ----
HC_plot <- ggplot(Hard_corals_depth, aes(x = Percentage, y = Depth, fill = Category)) +
geom_bar(stat = "identity", position = "fill", width = 0.6) +
scale_x_continuous(labels = percent_format(accuracy = 1)) +
scale_x_reverse() +   # ⬅️ HIGH VALUES ON THE LEFT
scale_y_discrete(limits = rev(depth_levels)) +
scale_fill_manual(values = color_palette) +
theme_bw() +
labs(x = "Percentage", y = "Depth (m)", fill = NULL) +
theme(
axis.title.x = element_text(size = 12, colour = "black"),
axis.title.y = element_text(size = 12, colour = "black"),
axis.text.x  = element_text(size = 12),
axis.text.y  = element_text(size = 12),
legend.position  = "bottom",
legend.direction = "horizontal",
legend.title = element_blank(),
legend.text  = element_text(size = 12)
) +
guides(fill = guide_legend(ncol = 12, byrow = TRUE))
## ---- Extract legend robustly ----
leg_list <- get_plot_component(HC_plot, "guide-box", return_all = TRUE)
legend_grob <- NULL
for (g in leg_list) {
if (!is.null(g) && inherits(g, "grob") &&
!is.null(g$grobs) && length(g$grobs) > 0) {
legend_grob <- g
break
}
}
if (is.null(legend_grob)) legend_grob <- leg_list[[length(leg_list)]]
legend_plot <- cowplot::ggdraw() + cowplot::draw_grob(legend_grob)
## ---- Main plot without legend ----
HC_plot_no_legend <- HC_plot + theme(legend.position = "none")
## ---- Optional: preview ----
print(HC_plot_no_legend)
grid.newpage(); grid.draw(legend_grob)   # preview legend grob
##### calculate LDM
# install.packages("LDM")
library(LDM)
str(metadata)
library(dplyr)
library(stringr)
metadata <-  metadata %>%
mutate(start_location = str_replace(start_location, "-", "_"))
View(metadata)
# Hellinger normalization:
Hard_corals_image_wide_hell=decostand(Hard_corals_image_wide, method="hellinger", MARGIN=2)
metadata <-  metadata %>%
mutate(start_location = str_replace(start_location, "-", "_"))
Hard_corals_image_wide_hell_t=as.data.frame(t(Hard_corals_image_wide_hell))
colSums(Hard_corals_image_wide_hell_t > 0)
Hard_corals_image_wide_hell_t_filter=Hard_corals_image_wide_hell_t[,colSums(Hard_corals_image_wide_hell_t > 0)>10]
HC_LDM=ldm(formula=Hard_corals_image_wide_hell_t_filter~DEPTH+SITE,
data=metadata, seed=12345, test.omni3 = TRUE, verbose=TRUE)
# install.packages("LDM")
library(LDM)
install.packages("LDM")
# install.packages("LDM")
library(LDM)
# install.packages("LDM")
devtools::install_github("yijuanhu/LDM", build_vignettes=TRUE)
